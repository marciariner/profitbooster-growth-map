<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Your Profit Booster® Growth Map</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:2rem;background:#f8fafc}
  .wrap{max-width:760px;margin:0 auto}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
  h1{font-size:1.6rem;margin:.2rem 0 1rem}
  .muted{color:#64748b;margin:.2rem 0 1.2rem}
  ol{margin-left:1.25rem}
  .cta{display:inline-block;margin-top:1rem;background:#1860d1;color:#fff;padding:.8rem 1.2rem;border-radius:10px;text-decoration:none}
  .cta:hover{background:#0f4cb0}
  .err{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:.8rem;border-radius:10px}
  .dim{opacity:.7}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Profit Booster® Growth Map</h1>
    <p class="muted">Here’s where growth is hiding—and what to do first.</p>

    <div id="status" class="dim">Calculating your Growth Map…</div>
    <div id="result" style="display:none"></div>

    <a href="https://profitbooster.biz/booking" class="cta">Book Your Growth Jumpstart</a>
  </div>
</div>

<script>
(function(){
  const API_URL = '/api/growth-map'; // same-origin to avoid CORS
  const qs = new URLSearchParams(location.search);

  // Pull values from querystring (sent from your GHL page)
  const payload = {
    firstName:    qs.get('firstName')    || '',
    email:        qs.get('email')        || '',
    businessType: qs.get('businessType') || '',
    challenge:    qs.get('challenge')    || '',
    leadSources:  qs.get('leadSources')  || '',
    working:      qs.get('working')      || '',
    waste:        qs.get('waste')        || '',
    goal90:       qs.get('goal90')       || ''
  };

  // Minimal required fields — if missing, show a gentle error
  if (!payload.businessType || !payload.challenge || !payload.goal90) {
    document.getElementById('status').outerHTML =
      '<div class="err">Missing info. Please go back and complete Business Type, Biggest Challenge, and 90-Day Goal.</div>';
    return;
  }

  fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(out => {
    const box = document.getElementById('result');
    document.getElementById('status').style.display = 'none';
    box.style.display = 'block';
    box.innerHTML = `
      <p><strong>Your profit position today:</strong> ${out.positionLabel}${out.score ? ` (${out.score}/100)` : ''}</p>
      <ol>
        ${Array.isArray(out.moves) ? out.moves.map(m => `
          <li><strong>${m.name}</strong> — <em>What:</em> ${m.what}. <em>Why:</em> ${m.why}.</li>
        `).join('') : '<li>Result unavailable. Please try again.</li>'}
      </ol>
      <p><strong>Your next best action:</strong> ${out.nextAction || 'We’ll email your next step shortly.'}</p>
    `;
  })
  .catch(err => {
    document.getElementById('status').outerHTML =
      '<div class="err">We couldn’t generate your Growth Map right now. Please try again in a minute.</div>';
    console.error(err);
  });
})();
</script>
</body>
</html>

